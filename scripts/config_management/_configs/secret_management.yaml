# Secret Management Configuration Example
# Demonstrates secure handling of sensitive data and secrets
# Shows best practices for API keys, passwords, and credentials

# Environment Variables (Recommended for secrets)
secrets:
  # API Keys and Tokens
  openai_api_key: "${OPENAI_API_KEY}"
  anthropic_api_key: "${ANTHROPIC_API_KEY}"
  github_token: "${GITHUB_TOKEN}"
  slack_webhook: "${SLACK_WEBHOOK_URL}"

  # Database Credentials
  database_password: "${DB_PASSWORD}"
  redis_password: "${REDIS_PASSWORD}"
  mongodb_uri: "${MONGODB_URI}"

  # Cloud Service Credentials
  aws_access_key: "${AWS_ACCESS_KEY_ID}"
  aws_secret_key: "${AWS_SECRET_ACCESS_KEY}"
  azure_client_id: "${AZURE_CLIENT_ID}"
  azure_client_secret: "${AZURE_CLIENT_SECRET}"
  gcp_service_account_key: "${GCP_SERVICE_ACCOUNT_KEY}"

  # External Service Credentials
  stripe_secret_key: "${STRIPE_SECRET_KEY}"
  sendgrid_api_key: "${SENDGRID_API_KEY}"
  twilio_account_sid: "${TWILIO_ACCOUNT_SID}"
  twilio_auth_token: "${TWILIO_AUTH_TOKEN}"

# Secret Validation Configuration
secret_validation:
  # Required secrets by environment
  required_secrets:
    development:
      - openai_api_key
      - github_token
    staging:
      - openai_api_key
      - github_token
      - database_password
      - slack_webhook
    production:
      - openai_api_key
      - github_token
      - database_password
      - slack_webhook
      - aws_access_key
      - aws_secret_key

  # Secret format validation
  format_validation:
    api_keys:
      pattern: "^[a-zA-Z0-9_-]{20,}$"
      description: "API keys should be at least 20 characters"
    passwords:
      pattern: "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{12,}$"
      description: "Passwords must contain uppercase, lowercase, number, and special character"
    tokens:
      pattern: "^[a-zA-Z0-9_-]{32,}$"
      description: "Tokens should be at least 32 characters"

# Secret Rotation Configuration
secret_rotation:
  enabled: true
  rotation_schedule:
    api_keys: "90_days"
    database_passwords: "60_days"
    service_account_keys: "365_days"

  # Notification settings
  notifications:
    enabled: true
    channels:
      - email
      - slack
    advance_notice_days: 7

# Secret Storage Configuration
secret_storage:
  # Primary storage method
  primary:
    type: "environment"
    description: "Environment variables (most secure for containers)"

  # Backup storage methods
  backup:
    - type: "aws_secrets_manager"
      region: "${AWS_REGION}"
      enabled: "${USE_AWS_SECRETS:true}"
    - type: "azure_key_vault"
      vault_url: "${AZURE_VAULT_URL}"
      enabled: "${USE_AZURE_VAULT:false}"
    - type: "gcp_secret_manager"
      project_id: "${GCP_PROJECT_ID}"
      enabled: "${USE_GCP_SECRETS:false}"

# Encryption Configuration
encryption:
  # Data encryption settings
  data_encryption:
    algorithm: "AES-256-GCM"
    key_rotation: "30_days"

  # Secret encryption at rest
  secret_encryption:
    enabled: true
    algorithm: "AES-256"
    key_source: "aws_kms"

  # Transit encryption
  transit_encryption:
    enabled: true
    tls_version: "1.3"
    certificate_validation: true

# Access Control Configuration
access_control:
  # Secret access policies
  policies:
    read_only:
      - "openai_api_key"
      - "github_token"
    admin_only:
      - "database_password"
      - "aws_secret_key"
    service_only:
      - "service_account_keys"

  # Role-based access
  roles:
    developer:
      permissions:
        - read: ["openai_api_key", "github_token"]
        - write: []
    admin:
      permissions:
        - read: ["*"]
        - write: ["*"]
    service:
      permissions:
        - read: ["service_account_keys", "database_password"]
        - write: []

# Audit and Compliance
audit:
  # Audit logging
  audit_logging:
    enabled: true
    log_level: "INFO"
    log_destination: "security_audit.log"

    # Events to audit
    audit_events:
      - "secret_access"
      - "secret_rotation"
      - "secret_creation"
      - "secret_deletion"
      - "access_denied"

  # Compliance settings
  compliance:
    gdpr_compliant: true
    hipaa_compliant: false
    soc2_compliant: true

    # Data retention
    retention_periods:
      audit_logs: "7_years"
      secret_versions: "2_years"
      access_logs: "2_years"

# Monitoring and Alerting
monitoring:
  # Secret health monitoring
  health_checks:
    enabled: true
    interval: 300  # 5 minutes

    checks:
      - name: "secret_expiration"
        threshold: "30_days"
        alert: true
      - name: "secret_access_anomalies"
        threshold: "unusual_activity"
        alert: true
      - name: "secret_rotation_overdue"
        threshold: "7_days_past_due"
        alert: true

  # Alert configuration
  alerts:
    channels:
      - email
      - slack
      - pager_duty
    escalation:
      - delay: 0
        channels: ["email"]
      - delay: 3600
        channels: ["slack"]
      - delay: 7200
        channels: ["pager_duty"]

# Development and Testing
development:
  # Mock secrets for testing
  mock_secrets:
    enabled: "${USE_MOCK_SECRETS:false}"
    mock_values:
      openai_api_key: "sk-mock-key-1234567890abcdef"
      github_token: "ghp_mock_token_1234567890abcdef"
      database_password: "mock_password_123"

  # Secret masking in logs
  log_masking:
    enabled: true
    mask_patterns:
      - pattern: "(api_key|token|password|secret)[\"']?:\\s*[\"']([^\"']+)[\"']"
        replacement: "\\1\": \"***MASKED***\""
      - pattern: "(sk-|pk_|Bearer\\s+)([a-zA-Z0-9_-]{10})[a-zA-Z0-9_-]*"
        replacement: "\\1\\2***"

# Backup and Recovery
backup_recovery:
  # Secret backup
  secret_backup:
    enabled: true
    schedule: "daily"
    retention: "30_days"
    encryption: true

  # Recovery procedures
  recovery:
    automated_recovery: true
    manual_recovery_steps:
      - "Access backup storage"
      - "Decrypt backup if needed"
      - "Restore secrets to primary storage"
      - "Update application configuration"
      - "Restart affected services"

# Integration Examples
integrations:
  # Docker secrets
  docker:
    enabled: false
    secret_files:
      - "/run/secrets/openai_api_key"
      - "/run/secrets/database_password"

  # Kubernetes secrets
  kubernetes:
    enabled: false
    secret_names:
      - "codomyrmex-secrets"
    namespaces:
      - "default"

  # HashiCorp Vault
  vault:
    enabled: false
    address: "${VAULT_ADDR}"
    token: "${VAULT_TOKEN}"
    path: "secret/codomyrmex"

# Best Practices Documentation
best_practices:
  # General rules
  general:
    - "Never hardcode secrets in source code"
    - "Use environment variables for secrets"
    - "Rotate secrets regularly"
    - "Use principle of least privilege"
    - "Audit secret access"

  # Development practices
  development:
    - "Use mock secrets for local development"
    - "Never commit secrets to version control"
    - "Use different secrets for each environment"
    - "Document secret requirements"

  # Production practices
  production:
    - "Use secret management services (AWS Secrets Manager, etc.)"
    - "Enable encryption at rest and in transit"
    - "Implement secret rotation policies"
    - "Monitor secret access and usage"
    - "Have disaster recovery procedures"
