# Build Synthesis - Tutorial: Triggering a Python Module Build with `trigger_build`

This tutorial will guide you through using the `trigger_build` MCP tool from the Build Synthesis module to build a Python package (wheel) for a hypothetical Codomyrmex utility module.

## 1. Prerequisites

Before you begin, ensure you have the following:

- The Build Synthesis module installed and configured (see main [README.md](../../README.md)).
- A hypothetical Codomyrmex module named `sample_utility_module` existing within your project structure (e.g., `./codomyrmex/sample_utility_module/`).
- This `sample_utility_module` must have a valid `pyproject.toml` file and a `setup.cfg` or `setup.py` if needed by the build backend, configured for building a Python wheel. (See example in Step 1).
- Python build tools installed in your environment (e.g., `pip install build`).
- Familiarity with Python packaging concepts (wheel, sdist) and MCP tool invocation (e.g., via a hypothetical `codomyrmex_mcp_client`).

## 2. Goal

By the end of this tutorial, you will be able to:

- Successfully trigger a build for the `sample_utility_module` using the `trigger_build` tool.
- Locate the packaged Python wheel file generated by the build process.
- Understand how to specify a `target` and interpret the output from `trigger_build`.

## 3. Steps

### Step 1: Prepare Your Input/Environment

1.  **Create the `sample_utility_module` Directory Structure**:
    If it doesn't exist, create the following structure:
    ```
    codomyrmex/
    └── sample_utility_module/
        ├── __init__.py
        ├── utils.py
        └── pyproject.toml
    ```

2.  **Populate `codomyrmex/sample_utility_module/__init__.py`**:
    ```python
    # codomyrmex/sample_utility_module/__init__.py
    from .utils import greet

    VERSION = "0.1.0"
    ```

3.  **Populate `codomyrmex/sample_utility_module/utils.py`**:
    ```python
    # codomyrmex/sample_utility_module/utils.py
    def greet(name):
        return f"Hello, {name} from sample_utility_module!"
    ```

4.  **Create `codomyrmex/sample_utility_module/pyproject.toml`**:
    This file tells Python build tools how to build your package.
    ```toml
    # codomyrmex/sample_utility_module/pyproject.toml
    [build-system]
    requires = ["setuptools>=42", "wheel"]
    build-backend = "setuptools.build_meta"
    backend-path = "."

    [project]
    name = "codomyrmex_sample_utility_module"
    version = "0.1.0"
    description = "A sample utility module for Codomyrmex."
    authors = [
        { name = "Codomyrmex Developer", email = "dev@example.com" },
    ]
    readme = "README.md"
    requires-python = ">=3.8"
    classifiers = [
        "Programming Language :: Python :: 3",
        "License :: OSI Approved :: MIT License",
        "Operating System :: OS Independent",
    ]
    dependencies = []

    [project.urls]
    Homepage = "https://github.com/codomyrmex-project-org/codomyrmex"
    ```
    *(Optionally, add a simple `README.md` in `sample_utility_module/` if referenced in `pyproject.toml`)*

5.  **Ensure Build Tools are Available**:
    Open your terminal in the Codomyrmex project root:
    ```bash
    python -m pip install build --upgrade
    ```

### Step 2: Invoke `trigger_build`

Now, use the `trigger_build` MCP tool. We'll use a hypothetical `codomyrmex_mcp_client` for this example. The `target` should correspond to how your build system identifies the module, which could be its directory name or a specific build target defined elsewhere (e.g. in a root Makefile if your project uses one that build_synthesis understands).

For a Python module with `pyproject.toml`, often the module directory is sufficient context for tools like `python -m build`.

**Using a hypothetical MCP client:**

```bash
# Ensure you are in the Codomyrmex project root directory
# The actual target might depend on how build_synthesis is implemented
# to locate and build Python modules. It might be the path or a registered name.
codomyrmex_mcp_client call build_synthesis trigger_build \
  --target "codomyrmex/sample_utility_module" \
  --config '{"profile": "release"}' \
  --clean_build true \
  --output_path "./output/builds/sample_utility_module_pkg/"
```

**Parameters used:**
- `target`: Path to the module to be built or a registered target name. The `build_synthesis` module will use this to find the `pyproject.toml` (for Python) or other build manifests and initiate the build.
- `config`: Optional JSON string or path to config file, e.g., `'{"profile": "release"}'`. The build tool might use this to set specific flags.
- `clean_build`: `true` to remove previous build artifacts (like `build/` and `dist/` directories within the module) before building.
- `output_path`: A suggested directory where the final artifacts (like the wheel file) should be copied by the `build_synthesis` module *after* the build tool (e.g. `python -m build`) creates them in the module's `dist/` directory.

### Step 3: Verify the Output/Artifacts

1.  **Check MCP Response**: The JSON response from the client should indicate success:
    ```json
    {
      "status": "success",
      "artifact_paths": [
        "./output/builds/sample_utility_module_pkg/codomyrmex_sample_utility_module-0.1.0-py3-none-any.whl"
        // ... other artifacts like sdist might be listed ...
      ],
      "log_output": "Build process completed successfully...",
      "error_message": null
    }
    ```
    *(Note: The exact artifact name and log output will vary.)*

2.  **Verify Artifact Existence**: Check the specified `output_path` (or the default path if not specified and known) for the generated wheel file:
    ```bash
    ls -l ./output/builds/sample_utility_module_pkg/
    ```
    You should see a file like `codomyrmex_sample_utility_module-0.1.0-py3-none-any.whl`.

3.  **Check Module's `dist` directory**: The Python build process itself creates artifacts in the module's local `dist/` directory. The `build_synthesis` module might copy these to the `output_path`.
    ```bash
    ls -l codomyrmex/sample_utility_module/dist/
    ```

## 4. Understanding the Results

The `trigger_build` tool orchestrated the standard Python build process for `sample_utility_module`. This involves:
- Invoking a tool like `python -m build` on the `sample_utility_module` directory.
- This tool reads `pyproject.toml`, creates a build environment, and generates a source distribution (sdist) and a binary wheel (`.whl`) file in `sample_utility_module/dist/`.
- The `build_synthesis` module then (potentially) copies these artifacts to the specified `output_path` and reports their locations.

The `.whl` file is a ready-to-install package for your module.

## 5. Troubleshooting

- **Error: `Build failed for target ...`**
  - **Cause**: 
    - `pyproject.toml` is missing or has errors.
    - Required build dependencies (like `setuptools`, `wheel`) are not installed in the environment where `build_synthesis` runs the build command.
    - Issues in your `sample_utility_module` Python code preventing packaging.
    - The `target` path or name is incorrect or not understood by `build_synthesis`.
  - **Solution**:
    1. Carefully review the `log_output` and `error_message` from the MCP response.
    2. Manually try to build the module: `cd codomyrmex/sample_utility_module && python -m build`.
    3. Ensure `python -m pip install build setuptools wheel` has been run in the execution environment.
- **Artifacts not found in `output_path`**: 
  - **Cause**: The build might have succeeded locally within the module's `dist/` directory, but `build_synthesis` failed to copy them, or the `output_path` in the MCP response is different than expected.
  - **Solution**: Check the module's own `dist/` directory first. Review the `artifact_paths` from the MCP response carefully.

## 6. Next Steps

Congratulations on building a Python module using `trigger_build`!

Now you can try:
- Building other Python-based Codomyrmex modules.
- Exploring how `trigger_build` might work for different types of components (e.g., Docker images, if supported by your `build_synthesis` module implementation, which would require a `Dockerfile` as `target` or similar).
- Integrating this build step into an automated CI/CD pipeline.
- Using the generated wheel file by installing it into a virtual environment (`pip install ./output/builds/sample_utility_module_pkg/codomyrmex_sample_utility_module-0.1.0-py3-none-any.whl`) and trying to import your module. 