{% extends "base.html" %}

{% block title %}Pipelines - Codomyrmex{% endblock %}

{% block content %}
<h1>CI/CD Pipelines</h1>

<div class="grid">
    {% for pipeline in pipelines %}
    <div class="card">
        <h2 class="card-title">
            {{ pipeline.name }}
            <span
                class="status-badge {{ 'active' if pipeline.status == 'success' else 'error' if pipeline.status == 'failure' else 'running' if pipeline.status == 'running' else 'defined' }}">
                {{ pipeline.status|title }}
            </span>
        </h2>

        <p><strong>ID:</strong> <span class="mono">{{ pipeline.id }}</span></p>
        {% if pipeline.file %}
        <p><strong>File:</strong> <span class="mono">{{ pipeline.file }}</span></p>
        {% endif %}
        {% if pipeline.triggers %}
        <p><strong>Triggers:</strong> {{ pipeline.triggers|join(', ') }}</p>
        {% endif %}

        <div style="margin-top: 1.5rem;">
            <h4>Stages</h4>
            <div class="pipeline-visual">
                {% for stage in pipeline.stages %}
                <div class="stage-node {{ stage.status }}" aria-label="{{ stage.name }}: {{ stage.status }}">
                    <div class="stage-name">{{ stage.name }}</div>
                    <div class="stage-status">{{ stage.status|title }}</div>
                </div>
                {% if not loop.last %}
                <div class="stage-connector"></div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% if not pipelines %}
<div class="empty-state">
    <div class="empty-state-icon" aria-hidden="true">ðŸ”„</div>
    <p>No CI/CD pipelines found. Add workflow files to <code>.github/workflows/</code> to see them here.</p>
</div>
{% endif %}

{% endblock %}
