{% extends "base.html" %}

{% block title %}Dashboard - Codomyrmex{% endblock %}

{% block content %}
<h1>Command Center</h1>

<!-- Top Row: Key Metrics -->
<section aria-label="System Metrics">
<div class="dashboard-metrics">
    <div class="dash-metric">
        <span class="dash-metric-value status-ok">Operational</span>
        <span class="dash-metric-label">System Status</span>
    </div>
    <div class="dash-metric">
        <span class="dash-metric-value">{{ system.module_count }}</span>
        <span class="dash-metric-label">Modules</span>
    </div>
    <div class="dash-metric">
        <span class="dash-metric-value">{{ system.agent_count }}</span>
        <span class="dash-metric-label">Agent Integrations</span>
    </div>
    <div class="dash-metric">
        <span class="dash-metric-value">{{ scripts|length }}</span>
        <span class="dash-metric-label">Scripts</span>
    </div>
    <div class="dash-metric">
        <span class="dash-metric-value">{{ system.version }}</span>
        <span class="dash-metric-label">Version</span>
    </div>
    <div class="dash-metric">
        <span class="dash-metric-value">{{ system.environment }}</span>
        <span class="dash-metric-label">Environment</span>
    </div>
</div>
</section>

<!-- Main Grid -->
<div class="dashboard-grid">
    <!-- Git Status -->
    <div class="card">
        <h2 class="card-title">Git Status
            <span class="status-badge {% if health.git.dirty_files == 0 %}active{% else %}running{% endif %}">
                {{ health.git.status }}
            </span>
        </h2>
        <p><strong>Branch:</strong> <code>{{ health.git.branch }}</code></p>
        <p><strong>Commits:</strong> {{ health.git.commit_count }}</p>
        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
            {{ health.git.last_commit }}
        </p>
    </div>

    <!-- Coverage Overview -->
    <div class="card">
        <h2 class="card-title">Coverage</h2>
        <div class="coverage-bars" style="margin-top: 0.5rem;">
            <div class="coverage-row">
                <span class="coverage-label">API Specs</span>
                <div class="coverage-bar" role="progressbar" aria-valuenow="{{ health.modules.api_spec_pct }}" aria-valuemin="0" aria-valuemax="100" aria-label="API Specs coverage"><div class="coverage-fill" style="width: {{ health.modules.api_spec_pct }}%; background: var(--success-color);"></div></div>
                <span class="coverage-pct">{{ health.modules.api_spec_pct }}%</span>
            </div>
            <div class="coverage-row">
                <span class="coverage-label">Tests</span>
                <div class="coverage-bar" role="progressbar" aria-valuenow="{{ health.modules.test_coverage_pct }}" aria-valuemin="0" aria-valuemax="100" aria-label="Tests coverage"><div class="coverage-fill" style="width: {{ health.modules.test_coverage_pct }}%; background: var(--accent-color);"></div></div>
                <span class="coverage-pct">{{ health.modules.test_coverage_pct }}%</span>
            </div>
            <div class="coverage-row">
                <span class="coverage-label">MCP</span>
                <div class="coverage-bar" role="progressbar" aria-valuenow="{{ health.modules.mcp_spec_pct }}" aria-valuemin="0" aria-valuemax="100" aria-label="MCP Specs coverage"><div class="coverage-fill" style="width: {{ health.modules.mcp_spec_pct }}%; background: #8b5cf6;"></div></div>
                <span class="coverage-pct">{{ health.modules.mcp_spec_pct }}%</span>
            </div>
        </div>
    </div>

    <!-- Architecture Layers -->
    <div class="card">
        <h2 class="card-title">Architecture</h2>
        <div class="arch-layers-compact">
            {% for layer in health.architecture_layers %}
            <div class="arch-row">
                <span class="arch-dot" style="background: {{ layer.color }};"></span>
                <span class="arch-name">{{ layer.name }}</span>
                <span class="arch-count">{{ layer.modules|length }}</span>
                <div class="arch-bar">
                    <div class="arch-bar-fill" style="width: {% if system.module_count > 0 %}{{ (layer.modules|length / system.module_count * 100)|round }}{% else %}0{% endif %}%; background: {{ layer.color }};"></div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Quick Navigation -->
    <div class="card">
        <h2 class="card-title">Quick Actions</h2>
        <div class="quick-actions">
            <a href="health.html" class="quick-btn">System Health</a>
            <a href="modules.html" class="quick-btn">Browse Modules</a>
            <a href="agents.html" class="quick-btn">AI Agents</a>
            <a href="scripts.html" class="quick-btn">Run Scripts</a>
            <a href="docs.html" class="quick-btn">Documentation</a>
            <a href="config.html" class="quick-btn">Edit Config</a>
            <button id="refresh-data-btn" class="quick-btn" style="border: none; cursor: pointer; font-family: inherit; font-size: inherit;">Refresh Data</button>
        </div>
    </div>
</div>

<style>
    .dashboard-metrics {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .dash-metric {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 1rem;
        text-align: center;
    }

    .dash-metric-value {
        display: block;
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
    }

    .dash-metric-label {
        font-size: 0.75rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
    }

    .coverage-bars { display: flex; flex-direction: column; gap: 0.6rem; }
    .coverage-row { display: flex; align-items: center; gap: 0.6rem; }
    .coverage-label { width: 70px; font-size: 0.8rem; color: var(--text-secondary); }
    .coverage-bar { flex: 1; height: 6px; background: var(--bg-tertiary); border-radius: 3px; overflow: hidden; }
    .coverage-fill { height: 100%; border-radius: 3px; }
    .coverage-pct { width: 45px; text-align: right; font-size: 0.8rem; font-weight: 600; font-family: 'Fira Code', monospace; }

    .arch-layers-compact { display: flex; flex-direction: column; gap: 0.5rem; margin-top: 0.5rem; }
    .arch-row { display: flex; align-items: center; gap: 0.5rem; }
    .arch-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
    .arch-name { font-size: 0.85rem; width: 85px; }
    .arch-count { font-size: 0.8rem; color: var(--text-secondary); width: 25px; text-align: right; font-family: 'Fira Code', monospace; }
    .arch-bar { flex: 1; height: 5px; background: var(--bg-tertiary); border-radius: 3px; overflow: hidden; }
    .arch-bar-fill { height: 100%; border-radius: 3px; }

    .quick-actions { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; }
    .quick-btn {
        display: block;
        text-align: center;
        padding: 0.6rem;
        background: var(--bg-tertiary);
        border-radius: 6px;
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 0.85rem;
        transition: var(--transition);
    }
    .quick-btn:hover { background: var(--accent-color); color: white; }

    @media (max-width: 900px) {
        .dashboard-metrics { grid-template-columns: repeat(3, 1fr); }
        .dashboard-grid { grid-template-columns: 1fr; }
    }
    @media (max-width: 600px) {
        .dashboard-metrics { grid-template-columns: repeat(2, 1fr); }
    }
</style>
{% endblock %}
