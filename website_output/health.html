<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health - Codomyrmex</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>◆</text></svg>">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    
</head>

<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <header>
        <nav aria-label="Main navigation">
            <a href="index.html" class="logo">
                <span style="color: var(--accent-color)" aria-hidden="true">◆</span> Codomyrmex
            </a>
            <div class="nav-links">
                <div class="nav-group" role="group" aria-label="Operations">
                    <span class="nav-group-label">Operations</span>
                    <a href="index.html" class="nav-link" data-shortcut="1">Dashboard</a>
                    <a href="health.html" class="nav-link" data-shortcut="2">Health</a>
                    <a href="pipelines.html" class="nav-link" data-shortcut="3">Pipelines</a>
                </div>
                <div class="nav-divider" aria-hidden="true"></div>
                <div class="nav-group" role="group" aria-label="Development">
                    <span class="nav-group-label">Development</span>
                    <a href="modules.html" class="nav-link" data-shortcut="4">Modules</a>
                    <a href="scripts.html" class="nav-link" data-shortcut="5">Scripts</a>
                    <a href="config.html" class="nav-link" data-shortcut="6">Config</a>
                </div>
                <div class="nav-divider" aria-hidden="true"></div>
                <div class="nav-group" role="group" aria-label="Intelligence">
                    <span class="nav-group-label">Intelligence</span>
                    <a href="agents.html" class="nav-link" data-shortcut="7">Agents</a>
                    <a href="chat.html" class="nav-link" data-shortcut="8">Chat</a>
                    <a href="docs.html" class="nav-link" data-shortcut="9">Docs</a>
                    <a href="awareness.html" class="nav-link" data-shortcut="0">Awareness</a>
                </div>
            </div>
        </nav>
    </header>

    <main id="main-content">
        
<h1>System Health</h1>

<!-- Connection status indicator (Fix #2) -->
<div id="connection-status" class="connection-status connection-ok" aria-live="polite">
    <span class="connection-dot"></span>
    <span id="connection-text">Connected</span>
</div>

<div class="health-grid">
    <!-- System Vitals -->
    <div class="card health-card">
        <h2 class="card-title">System Vitals</h2>
        <div class="metric-grid">
            <div class="metric">
                <span class="metric-value" id="uptime">0h 0m 0s</span>
                <span class="metric-label">Uptime</span>
            </div>
            <div class="metric">
                <span class="metric-value" id="python-version">3.13.11</span>
                <span class="metric-label">Python</span>
            </div>
            <div class="metric">
                <span class="metric-value" id="module-count">94</span>
                <span class="metric-label">Modules</span>
            </div>
            <div class="metric">
                <span class="metric-value status-ok" id="system-status">Operational</span>
                <span class="metric-label">Status</span>
            </div>
        </div>
    </div>

    <!-- Git Status -->
    <div class="card health-card">
        <h2 class="card-title">Git Repository</h2>
        <div class="metric-grid">
            <div class="metric">
                <span class="metric-value mono" id="git-branch">main</span>
                <span class="metric-label">Branch</span>
            </div>
            <div class="metric">
                <span class="metric-value" id="git-commits">118</span>
                <span class="metric-label">Commits</span>
            </div>
            <div class="metric">
                <span class="metric-value status-warn"
                    id="git-status">
                    48 changed
                </span>
                <span class="metric-label">Working Tree</span>
            </div>
        </div>
        <p class="mono" id="git-last-commit"
            style="margin-top: 0.75rem; font-size: 0.85rem; color: var(--text-secondary);">
            3b324b79 up (18 minutes ago)
        </p>
    </div>

    <!-- Documentation Coverage -->
    <div class="card health-card">
        <h2 class="card-title">Documentation Coverage</h2>
        <div class="coverage-bars">
            <div class="coverage-row">
                <span class="coverage-label">API Specs</span>
                <div class="coverage-bar" role="progressbar" aria-valuenow="98.9"
                    aria-valuemin="0" aria-valuemax="100" aria-label="API Specs coverage" id="api-spec-bar">
                    <div class="coverage-fill"
                        style="width: 98.9%; background: var(--success-color);"></div>
                </div>
                <span class="coverage-pct" id="api-spec-pct">98.9%</span>
            </div>
            <div class="coverage-row">
                <span class="coverage-label">Test Dirs</span>
                <div class="coverage-bar" role="progressbar" aria-valuenow="98.9"
                    aria-valuemin="0" aria-valuemax="100" aria-label="Test Dirs coverage" id="test-coverage-bar">
                    <div class="coverage-fill"
                        style="width: 98.9%; background: var(--accent-color);"></div>
                </div>
                <span class="coverage-pct" id="test-coverage-pct">98.9%</span>
            </div>
            <div class="coverage-row">
                <span class="coverage-label">MCP Specs</span>
                <div class="coverage-bar" role="progressbar" aria-valuenow="61.7"
                    aria-valuemin="0" aria-valuemax="100" aria-label="MCP Specs coverage" id="mcp-spec-bar">
                    <div class="coverage-fill" style="width: 61.7%; background: #8b5cf6;">
                    </div>
                </div>
                <span class="coverage-pct" id="mcp-spec-pct">61.7%</span>
            </div>
        </div>
    </div>

    <!-- Architecture Layers -->
    <div class="card health-card">
        <h2 class="card-title">Architecture Layers</h2>
        <div class="arch-layers" id="arch-layers">
            
            <div class="arch-layer">
                <div class="arch-layer-header">
                    <span class="arch-layer-dot" style="background: #10b981;"></span>
                    <span class="arch-layer-name">Foundation</span>
                    <span class="arch-layer-count">4</span>
                </div>
                <div class="arch-layer-modules">
                    
                    <span class="arch-module-tag">logging_monitoring</span>
                    
                    <span class="arch-module-tag">environment_setup</span>
                    
                    <span class="arch-module-tag">model_context_protocol</span>
                    
                    <span class="arch-module-tag">terminal_interface</span>
                    
                    
                </div>
            </div>
            
            <div class="arch-layer">
                <div class="arch-layer-header">
                    <span class="arch-layer-dot" style="background: #3b82f6;"></span>
                    <span class="arch-layer-name">Core</span>
                    <span class="arch-layer-count">6</span>
                </div>
                <div class="arch-layer-modules">
                    
                    <span class="arch-module-tag">agents</span>
                    
                    <span class="arch-module-tag">static_analysis</span>
                    
                    <span class="arch-module-tag">coding</span>
                    
                    <span class="arch-module-tag">llm</span>
                    
                    <span class="arch-module-tag">pattern_matching</span>
                    
                    <span class="arch-module-tag">git_operations</span>
                    
                    
                </div>
            </div>
            
            <div class="arch-layer">
                <div class="arch-layer-header">
                    <span class="arch-layer-dot" style="background: #8b5cf6;"></span>
                    <span class="arch-layer-name">Service</span>
                    <span class="arch-layer-count">5</span>
                </div>
                <div class="arch-layer-modules">
                    
                    <span class="arch-module-tag">build_synthesis</span>
                    
                    <span class="arch-module-tag">documentation</span>
                    
                    <span class="arch-module-tag">ci_cd_automation</span>
                    
                    <span class="arch-module-tag">containerization</span>
                    
                    <span class="arch-module-tag">orchestrator</span>
                    
                    
                </div>
            </div>
            
            <div class="arch-layer">
                <div class="arch-layer-header">
                    <span class="arch-layer-dot" style="background: #f59e0b;"></span>
                    <span class="arch-layer-name">Application</span>
                    <span class="arch-layer-count">3</span>
                </div>
                <div class="arch-layer-modules">
                    
                    <span class="arch-module-tag">cli</span>
                    
                    <span class="arch-module-tag">system_discovery</span>
                    
                    <span class="arch-module-tag">website</span>
                    
                    
                </div>
            </div>
            
            <div class="arch-layer">
                <div class="arch-layer-header">
                    <span class="arch-layer-dot" style="background: #94a3b8;"></span>
                    <span class="arch-layer-name">Extended</span>
                    <span class="arch-layer-count">76</span>
                </div>
                <div class="arch-layer-modules">
                    
                    <span class="arch-module-tag">accessibility</span>
                    
                    <span class="arch-module-tag">agentic_memory</span>
                    
                    <span class="arch-module-tag">api</span>
                    
                    <span class="arch-module-tag">audio</span>
                    
                    <span class="arch-module-tag">auth</span>
                    
                    <span class="arch-module-tag">cache</span>
                    
                    <span class="arch-module-tag">cerebrum</span>
                    
                    <span class="arch-module-tag">chaos_engineering</span>
                    
                    
                    <span class="arch-module-tag more">+68 more</span>
                    
                </div>
            </div>
            
        </div>
    </div>

    <!-- Test Runner (Fix #12: controls moved out of h2) -->
    <div class="card health-card" style="grid-column: 1 / -1;">
        <div class="test-runner-header">
            <h2 class="card-title">Test Runner</h2>
            <div class="test-runner-controls">
                <label for="test-module" class="sr-only">Select test module</label>
                <select id="test-module">
                    <option value="">All Tests</option>
                    
                    <option value="accessibility">accessibility</option>
                    
                    <option value="agentic_memory">agentic_memory</option>
                    
                    <option value="agents">agents</option>
                    
                    <option value="api">api</option>
                    
                    <option value="audio">audio</option>
                    
                    <option value="auth">auth</option>
                    
                    <option value="build_synthesis">build_synthesis</option>
                    
                    <option value="cache">cache</option>
                    
                    <option value="cerebrum">cerebrum</option>
                    
                    <option value="chaos_engineering">chaos_engineering</option>
                    
                    <option value="ci_cd_automation">ci_cd_automation</option>
                    
                    <option value="cli">cli</option>
                    
                    <option value="cloud">cloud</option>
                    
                    <option value="coding">coding</option>
                    
                    <option value="collaboration">collaboration</option>
                    
                    <option value="compression">compression</option>
                    
                    <option value="concurrency">concurrency</option>
                    
                    <option value="config_management">config_management</option>
                    
                    <option value="containerization">containerization</option>
                    
                    <option value="cost_management">cost_management</option>
                    
                    <option value="dark">dark</option>
                    
                    <option value="data_lineage">data_lineage</option>
                    
                    <option value="data_visualization">data_visualization</option>
                    
                    <option value="database_management">database_management</option>
                    
                    <option value="defense">defense</option>
                    
                    <option value="deployment">deployment</option>
                    
                    <option value="documentation">documentation</option>
                    
                    <option value="documents">documents</option>
                    
                    <option value="edge_computing">edge_computing</option>
                    
                    <option value="embodiment">embodiment</option>
                    
                    <option value="encryption">encryption</option>
                    
                    <option value="environment_setup">environment_setup</option>
                    
                    <option value="events">events</option>
                    
                    <option value="evolutionary_ai">evolutionary_ai</option>
                    
                    <option value="examples">examples</option>
                    
                    <option value="exceptions">exceptions</option>
                    
                    <option value="feature_flags">feature_flags</option>
                    
                    <option value="feature_store">feature_store</option>
                    
                    <option value="fpf">fpf</option>
                    
                    <option value="git_operations">git_operations</option>
                    
                    <option value="graph_rag">graph_rag</option>
                    
                    <option value="i18n">i18n</option>
                    
                    <option value="ide">ide</option>
                    
                    <option value="identity">identity</option>
                    
                    <option value="inference_optimization">inference_optimization</option>
                    
                    <option value="llm">llm</option>
                    
                    <option value="logging_monitoring">logging_monitoring</option>
                    
                    <option value="logistics">logistics</option>
                    
                    <option value="market">market</option>
                    
                    <option value="metrics">metrics</option>
                    
                    <option value="migration">migration</option>
                    
                    <option value="model_context_protocol">model_context_protocol</option>
                    
                    <option value="model_ops">model_ops</option>
                    
                    <option value="model_registry">model_registry</option>
                    
                    <option value="module_template">module_template</option>
                    
                    <option value="multimodal">multimodal</option>
                    
                    <option value="networking">networking</option>
                    
                    <option value="notification">notification</option>
                    
                    <option value="observability_dashboard">observability_dashboard</option>
                    
                    <option value="orchestrator">orchestrator</option>
                    
                    <option value="pattern_matching">pattern_matching</option>
                    
                    <option value="performance">performance</option>
                    
                    <option value="physical_management">physical_management</option>
                    
                    <option value="plugin_system">plugin_system</option>
                    
                    <option value="privacy">privacy</option>
                    
                    <option value="prompt_testing">prompt_testing</option>
                    
                    <option value="quantum">quantum</option>
                    
                    <option value="rate_limiting">rate_limiting</option>
                    
                    <option value="scheduler">scheduler</option>
                    
                    <option value="scrape">scrape</option>
                    
                    <option value="search">search</option>
                    
                    <option value="security">security</option>
                    
                    <option value="serialization">serialization</option>
                    
                    <option value="service_mesh">service_mesh</option>
                    
                    <option value="skills">skills</option>
                    
                    <option value="smart_contracts">smart_contracts</option>
                    
                    <option value="spatial">spatial</option>
                    
                    <option value="static_analysis">static_analysis</option>
                    
                    <option value="streaming">streaming</option>
                    
                    <option value="system_discovery">system_discovery</option>
                    
                    <option value="telemetry">telemetry</option>
                    
                    <option value="templating">templating</option>
                    
                    <option value="terminal_interface">terminal_interface</option>
                    
                    <option value="testing">testing</option>
                    
                    <option value="tests">tests</option>
                    
                    <option value="tools">tools</option>
                    
                    <option value="tree_sitter">tree_sitter</option>
                    
                    <option value="utils">utils</option>
                    
                    <option value="validation">validation</option>
                    
                    <option value="vector_store">vector_store</option>
                    
                    <option value="video">video</option>
                    
                    <option value="wallet">wallet</option>
                    
                    <option value="website">website</option>
                    
                    <option value="workflow_testing">workflow_testing</option>
                    
                </select>
                <button id="run-tests-btn" class="btn btn-primary" style="padding: 0.25rem 1rem; font-size: 0.85rem;">
                    Run Tests
                </button>
            </div>
        </div>
        <div id="test-results" class="test-results" role="status" aria-live="polite">
            <p style="color: var(--text-secondary);">Click "Run Tests" to execute the test suite.</p>
        </div>
        <div id="test-output" class="console hidden" style="max-height: 300px;"></div>
    </div>
</div>

<style>
    .health-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
    }

    .health-card .card-title {
        margin-bottom: 1rem;
    }

    .metric-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }

    .metric {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .metric-value {
        font-size: 1.4rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .metric-value.mono {
        font-family: 'Fira Code', monospace;
        font-size: 1.1rem;
    }

    .metric-label {
        font-size: 0.8rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .status-ok {
        color: var(--success-color);
    }

    .status-warn {
        color: #f59e0b;
    }

    .status-err {
        color: var(--error-color);
    }

    .coverage-bars {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .coverage-row {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .coverage-label {
        width: 80px;
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    .coverage-bar {
        flex: 1;
        height: 8px;
        background: var(--bg-tertiary);
        border-radius: 4px;
        overflow: hidden;
    }

    .coverage-fill {
        height: 100%;
        border-radius: 4px;
        transition: width 0.6s ease;
    }

    .coverage-pct {
        width: 50px;
        text-align: right;
        font-size: 0.85rem;
        font-weight: 600;
        font-family: 'Fira Code', monospace;
    }

    .arch-layers {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .arch-layer-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .arch-layer-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
    }

    .arch-layer-name {
        font-weight: 600;
        font-size: 0.9rem;
    }

    .arch-layer-count {
        font-size: 0.8rem;
        color: var(--text-secondary);
        margin-left: auto;
    }

    .arch-layer-modules {
        display: flex;
        flex-wrap: wrap;
        gap: 0.25rem;
        margin-top: 0.25rem;
        padding-left: 1.25rem;
    }

    .arch-module-tag {
        font-size: 0.75rem;
        padding: 0.1rem 0.4rem;
        background: var(--bg-tertiary);
        border-radius: 4px;
        color: var(--text-secondary);
        font-family: 'Fira Code', monospace;
    }

    .arch-module-tag.more {
        color: var(--accent-color);
    }

    .test-results {
        margin-top: 0.5rem;
    }

    .test-summary {
        display: flex;
        gap: 2rem;
        padding: 1rem;
        background: var(--bg-tertiary);
        border-radius: 8px;
        margin-bottom: 0.75rem;
    }

    .test-stat {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .test-stat-value {
        font-size: 2rem;
        font-weight: 700;
        font-family: 'Fira Code', monospace;
    }

    .test-stat-label {
        font-size: 0.75rem;
        text-transform: uppercase;
        color: var(--text-secondary);
    }

    .test-runner-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .test-runner-controls {
        display: flex;
        gap: 0.5rem;
    }

    @media (max-width: 768px) {
        .health-grid {
            grid-template-columns: 1fr;
        }
    }

    /* Connection status indicator */
    .connection-status {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 0.75rem;
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 2rem;
        font-size: 0.75rem;
        z-index: 100;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .connection-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--text-secondary);
    }

    .connection-ok .connection-dot {
        background: var(--success-color);
        box-shadow: 0 0 8px var(--success-color);
    }

    .connection-warn .connection-dot {
        background: #f59e0b;
    }

    .connection-err .connection-dot {
        background: var(--error-color);
    }
</style>

<script>
    document.getElementById('run-tests-btn').addEventListener('click', async () => {
        const btn = document.getElementById('run-tests-btn');
        const moduleSelect = document.getElementById('test-module');
        const resultsDiv = document.getElementById('test-results');
        const outputDiv = document.getElementById('test-output');

        btn.disabled = true;
        btn.innerHTML = '<span class="loader"></span> Running...';
        resultsDiv.innerHTML = '<p style="color: var(--accent-color);">Running tests...</p>';
        outputDiv.classList.add('hidden');

        try {
            const body = moduleSelect.value ? { module: moduleSelect.value } : {};
            const response = await fetch('/api/tests', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });
            const data = await response.json();

            if (data.error) {
                resultsDiv.innerHTML = `<p class="status-err">${data.error}</p>`;
            } else {
                const statusClass = data.success ? 'status-ok' : 'status-err';
                resultsDiv.innerHTML = `
                    <div class="test-summary">
                        <div class="test-stat">
                            <span class="test-stat-value status-ok">${data.passed}</span>
                            <span class="test-stat-label">Passed</span>
                        </div>
                        <div class="test-stat">
                            <span class="test-stat-value status-err">${data.failed}</span>
                            <span class="test-stat-label">Failed</span>
                        </div>
                        <div class="test-stat">
                            <span class="test-stat-value ${data.errors > 0 ? 'status-err' : 'status-ok'}">${data.errors}</span>
                            <span class="test-stat-label">Errors</span>
                        </div>
                        <div class="test-stat">
                            <span class="test-stat-value" style="color: var(--text-secondary);">${data.skipped}</span>
                            <span class="test-stat-label">Skipped</span>
                        </div>
                        <div class="test-stat">
                            <span class="test-stat-value">${data.total}</span>
                            <span class="test-stat-label">Total</span>
                        </div>
                        <div class="test-stat">
                            <span class="test-stat-value ${statusClass}">${data.success ? 'PASS' : 'FAIL'}</span>
                            <span class="test-stat-label">Result</span>
                        </div>
                    </div>
                `;

                if (data.output) {
                    outputDiv.textContent = data.output;
                    outputDiv.classList.remove('hidden');
                }
            }
        } catch (err) {
            resultsDiv.innerHTML = `<p class="status-err">Network error: ${err.message}</p>`;
        } finally {
            btn.disabled = false;
            btn.textContent = 'Run Tests';
        }
    });

    // Auto-refresh uptime
    const uptimeEl = document.getElementById('uptime');
    if (uptimeEl) {
        setInterval(async () => {
            try {
                const resp = await fetch('/api/health');
                const data = await resp.json();
                uptimeEl.textContent = data.uptime;

                // Update connection status
                const connStatus = document.getElementById('connection-status');
                const connText = document.getElementById('connection-text');
                if (connStatus) {
                    connStatus.className = 'connection-status connection-ok';
                    connText.textContent = 'Connected';
                }
            } catch (e) {
                // Update connection status
                const connStatus = document.getElementById('connection-status');
                const connText = document.getElementById('connection-text');
                if (connStatus) {
                    connStatus.className = 'connection-status connection-err';
                    connText.textContent = 'Disconnected';
                }
            }
        }, 5000); // 5s refresh
    }
</script>

    </main>

    <script src="assets/js/app.js"></script>
</body>

</html>